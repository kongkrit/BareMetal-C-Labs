VS code set up instructions for both macos and windows.
integrate with docker desktop sidecar

- students already has docker desktop with the necessary image installed.
- student has already cloned instructor's github repo.
- the repo name is `BareMetal-C-Labs`. The repo structure is:
  - `BareMetal-C-Labs`               : root of project
  - `BareMetal-C-Labs/.vscode`       : folder where tasks.json lives
  - `BareMetal-C-Labs/code`          : folder where student's code will be
  - `BareMetal-C-Labs/code/makefile` : makefile to build 

- student has already installed vs code, but hasn't configured anything.

- we use sdcc compiler targeting z80. no stdio.h and stdlib.h. we ony use stdbool.h and stdint.h.

- the student has extracted the sdcc header to their clone of the repo by
  ```
  docker run --rm -v "${PWD}/.vscode:/target" kongkrit/baremetal-c cp -r /usr/share/sdcc/include /target/sdcc-include
  ```
- I am sure the student has extracted headers correctly. do not suggest this step in .vscode/tasks.json file.

- the command to load tools is: ` docker run --name baremetal-c --rm -it -v ${PWD}:/labs kongkrit/baremetal-c` where ${PWD} will point to root of the project (BareMetal-C-Labs/)

- build command is "make" run at (BareMetal-C-Labs/code/) where makefile is.

- make does not take any argument to build. just "make"

- I want "make clean" to clean-up.

- the job finishes at make, since the final build result will be run in simulide simulator. do not "run" anything from vs code.

---
### here's my .gitattributes
```
makefile text eol=lf
*.c text
*.h text
*.sh text eol=lf
```

---
### here's my .gitignore:
```
# VS Code Local Caches
.vscode/browse.vc.db
.vscode/ipch/

# Extracted SDCC Headers (Generated by student locally)
.vscode/sdcc-include/

# I have already ignored all build artifacts
```

---
### here's my .vscode/extensions.json
```json
{
    "recommendations": [
        "ms-vscode.cpptools"
    ]
}
```

---
### here's my .vscode/c_cpp_properties.json
```json
{
    "configurations": [
        {
            "name": "SDCC Z80",
            "includePath": [
                "${workspaceFolder}/**",
                "${workspaceFolder}/.vscode/sdcc-include"
            ],
            "defines": [
                "__z80",
                "__sdcc",
                "__interrupt=",
                "__naked=",
                "__critical=",
                "__asm=;",
                "__endasm=;",
                "__at(x)="
            ],
            "compilerPath": "",
            "cStandard": "c99",
            "intelliSenseMode": "linux-gcc-x64",
            "browse": {
                "limitSymbolsToIncludedHeaders": true,
                "path": [
                    "${workspaceFolder}/**",
                    "${workspaceFolder}/.vscode/sdcc-include"
                ]
            }
        }
    ],
    "version": 4
}
```

---
### here's my .vscode/tasks.json
```json
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Build BareMetal C",
            "type": "shell",
            "command": "docker",
            "args": [
                "run",
                "--rm",
                "-v", "${workspaceFolder}:/labs",
                "kongkrit/baremetal-c",
                "make",
                "-C", "/labs/code"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "Clean Project",
            "type": "shell",
            "command": "docker",
            "args": [
                "run",
                "--rm",
                "-v", "${workspaceFolder}:/labs",
                "kongkrit/baremetal-c",
                "make",
                "-C", "/labs/code",
                "clean"
            ],
            "group": {
                "kind": "build",
                "isDefault": false
            },
            "presentation": {
                "echo": true,
                "reveal": "always",
                "panel": "shared"
            }
        }
    ]
}
```

1. Check whether what I have is sufficient.
2. Is there any other configuration to do in VS Code?



# END HERE
# END HERE
---

### here's my .vscode/tasks.json
```
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Build BareMetal C",
            "type": "shell",
            "command": "docker",
            "args": [
                "run",
                "--rm",
                "-v", "${workspaceFolder}:/labs",
                "kongkrit/baremetal-c",
                "make",
                "-C", "/labs/code"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            },
            "problemMatcher": []
        }
    ]
}
```


2. suggest whether i should remove `--rm` flag from `docker run`. I don't want to rebuild the container every time. 

3. is it possible not to re-run docker every time student touches a .c file? That would be slow.




The Optimized Workflow
You can set up two tasks: one to Start the environment (run once per session) and one to Build (run repeatedly).

Here is the advanced tasks.json for this workflow:
```
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "1. Start Build Server",
            "type": "shell",
            "command": "docker run -d --name baremetal-c --rm -v \"${workspaceFolder}:/labs\" kongkrit/baremetal-c sleep infinity",
            "problemMatcher": [],
            "detail": "Run this once when you open VS Code."
        },
        {
            "label": "2. Build Project (Fast)",
            "type": "shell",
            "command": "docker exec baremetal-c make -C /labs/code",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": [],
            "detail": "Compiles code instantly inside the running server."
        },
        {
            "label": "3. Stop Build Server",
            "type": "shell",
            "command": "docker stop baremetal-c",
            "problemMatcher": [],
            "detail": "Run this when you are done."
        }
    ]
}
```

---

Robust Auto-Start tasks.json
This configuration uses a trick: it chains commands to ensure a clean slate every time the folder is opened.
```
{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "1. Start/Reset Build Server",
            "type": "shell",
            "windows": {
                "command": "docker rm -f baremetal-c ; docker run -d --name baremetal-c --rm -v \"${workspaceFolder}:/labs\" kongkrit/baremetal-c sleep infinity"
            },
            "osx": {
                "command": "docker rm -f baremetal-c || true && docker run -d --name baremetal-c --rm -v \"${workspaceFolder}:/labs\" kongkrit/baremetal-c sleep infinity"
            },
            "runOptions": {
                "runOn": "folderOpen"
            },
            "presentation": {
                "echo": false,
                "reveal": "silent",
                "focus": false,
                "panel": "shared"
            },
            "problemMatcher": [],
            "detail": "Auto-starts the docker container when VS Code opens."
        },
        {
            "label": "2. Build Project",
            "type": "shell",
            "command": "docker exec baremetal-c make -C /labs/code",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": {
                "owner": "cpp",
                "fileLocation": ["relative", "${workspaceFolder}/code"],
                "pattern": {
                    "regexp": "^(.*):(\\d+):(\\d+):\\s+(warning|error):\\s+(.*)$",
                    "file": 1,
                    "line": 2,
                    "column": 3,
                    "severity": 4,
                    "message": 5
                }
            },
            "detail": "Compiles code instantly inside the running server."
        },
        {
            "label": "3. Stop Build Server",
            "type": "shell",
            "command": "docker kill baremetal-c",
            "problemMatcher": [],
            "detail": "Manually stops the container."
        }
    ]
}
```